<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R&C GOLD - NETRANGE EDITION</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>

    <style>
        /* --- ESTILO FLAT OTIMIZADO (SEM SOMBRAS PESADAS) --- */
        :root { 
            --bg: #000000; 
            --gold: #FFD700; 
            --card: #111;
            --border: #333;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; user-select: none; }
        
        body {
            background-color: var(--bg); 
            color: #fff;
            font-family: 'Montserrat', sans-serif;
            width: 100vw; height: 100vh; overflow: hidden;
        }

        .hide { display: none !important; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; background: #000; }

        /* FOCO VISÍVEL E LEVE */
        .focused {
            background: var(--gold) !important;
            color: #000 !important;
            border-color: #fff !important;
            font-weight: 800 !important;
        }
        .focused i, .focused span, .focused div { color: #000 !important; }

        /* LOGIN */
        .login-box { 
            width: 400px; padding: 30px; background: #111; 
            border: 2px solid var(--border); text-align: center; 
        }
        .logo-txt { font-size: 32px; font-weight: 900; margin-bottom: 20px; letter-spacing: -1px; }
        .logo-txt span { color: var(--gold); }
        .inp { width: 100%; padding: 12px; margin: 8px 0; background: #222; border: 1px solid #444; color: #fff; text-align: center; }
        .btn { width: 100%; padding: 14px; margin-top: 15px; background: #333; color: #fff; border: 1px solid #555; font-weight: 900; text-transform: uppercase; }

        /* DASHBOARD (MENU PRINCIPAL) */
        #dash-layer { display: flex; flex-direction: column; padding: 30px; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        .dash-info-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
            background: #111; padding: 20px; border: 1px solid #333; margin-bottom: 30px;
        }
        .info-item { display: flex; flex-direction: column; }
        .lbl { font-size: 11px; color: #777; font-weight: 700; text-transform: uppercase; }
        .val { font-size: 16px; color: var(--gold); font-weight: 600; margin-top: 2px; }

        .clock-box { text-align: right; }
        .time { font-size: 30px; font-weight: 800; line-height: 1; }
        .date { font-size: 12px; color: #888; text-transform: uppercase; margin-top: 5px; }

        .dash-grid { display: flex; gap: 30px; justify-content: center; align-items: center; flex: 1; }
        .smart-card { 
            width: 200px; height: 200px; background: #111; border: 2px solid #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .smart-card i { font-size: 50px; margin-bottom: 20px; color: #555; }
        .smart-card span { font-size: 14px; font-weight: 800; color: #ccc; letter-spacing: 1px; }

        /* PLAYER / LISTA */
        #content-layer { display: flex; height: 100vh; }
        .col-cat { width: 25%; background: #080808; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .cat-head { padding: 15px; background: #111; color: var(--gold); font-weight: 900; text-align: center; font-size: 14px; border-bottom: 2px solid #333; }
        .cat-list { flex: 1; overflow-y: auto; }
        .cat-item { padding: 12px 20px; border-bottom: 1px solid #1a1a1a; font-size: 13px; font-weight: 600; color: #999; }
        .cat-item.active { background: #222; color: #fff; border-left: 4px solid var(--gold); }

        .col-list { width: 30%; background: #0f0f0f; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .search-area { padding: 10px; background: #111; border-bottom: 1px solid #333; }
        .inp-search { width: 100%; background: #222; border: 1px solid #333; color: #fff; padding: 8px; text-align: center; text-transform: uppercase; font-weight: bold; }
        .item-list { flex: 1; overflow-y: auto; }
        .item { padding: 12px 20px; border-bottom: 1px solid #1f1f1f; font-size: 14px; color: #bbb; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .item.playing { color: var(--gold); background: #1a1a1a; font-weight: bold; }

        .col-play { flex: 1; background: #000; display: flex; flex-direction: column; }
        .vid-box { width: 100%; height: 50%; background: #000; position: relative; }
        
        video { width: 100%; height: 100%; background: #000; object-fit: contain; }
        
        /* FULLSCREEN */
        .vid-box.fs {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 9999;
        }

        .meta { padding: 20px; flex: 1; background: #111; display: flex; flex-direction: column; font-size: 13px; }
        .meta-title { font-size: 20px; color: var(--gold); font-weight: 800; margin-bottom: 10px; }
        
        /* BOTÕES COLORIDOS */
        .keys { 
            display: flex; gap: 20px; margin-top: auto; padding-top: 15px; border-top: 1px solid #333; 
        }
        .key { display: flex; align-items: center; gap: 8px; font-size: 11px; font-weight: 700; color: #888; text-transform: uppercase; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        
        #loader { background: #000; z-index: 20000; flex-direction: column; color: var(--gold); font-weight: 900; }
        .osd { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.8); color: var(--gold); padding: 5px 15px; display: none; border: 1px solid var(--gold); z-index: 10001; }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #444; }
    </style>
</head>
<body onload="App.init()">

    <div id="loader" class="hide flex-center">
        <i class="fas fa-spinner fa-spin" style="font-size: 40px; margin-bottom: 15px;"></i>
        <div id="load-txt">CARREGANDO...</div>
    </div>

    <div id="login-layer" class="layer flex-center">
        <div class="login-box">
            <div class="logo-txt">R&C <span>GOLD</span></div>
            <input type="text" id="i0" class="inp" placeholder="DNS (http://...)" autocomplete="off">
            <input type="text" id="i1" class="inp" placeholder="USUÁRIO" autocomplete="off">
            <input type="password" id="i2" class="inp" placeholder="SENHA" autocomplete="off">
            <button id="i3" class="btn" onclick="App.login()">ENTRAR</button>
            <div id="msg-login" style="color:#ff5555; margin-top:10px; font-size:12px;"></div>
        </div>
    </div>

    <div id="dash-layer" class="layer hide">
        <div class="top-bar">
            <div class="dash-logo logo-txt" style="margin:0; font-size: 28px;">R&C <span>GOLD</span></div>
            <div class="clock-box">
                <div id="clock-time" class="time">00:00</div>
                <div id="clock-date" class="date">SEGUNDA, 1 DE JANEIRO</div>
            </div>
        </div>

        <div class="dash-info-grid">
            <div class="info-item">
                <span class="lbl">USUÁRIO</span>
                <span id="u-name" class="val">...</span>
            </div>
            <div class="info-item">
                <span class="lbl">VENCIMENTO</span>
                <span id="u-exp" class="val">...</span>
            </div>
            <div class="info-item">
                <span class="lbl">CRIADO EM</span>
                <span id="u-created" class="val">...</span>
            </div>
            <div class="info-item">
                <span class="lbl">CONEXÕES</span>
                <span id="u-conn" class="val">...</span>
            </div>
        </div>

        <div class="dash-grid">
            <div id="m0" class="smart-card" onclick="App.openMode()">
                <i class="fas fa-tv"></i><span>TV AO VIVO</span>
            </div>
            <div id="m1" class="smart-card" onclick="App.logout()">
                <i class="fas fa-sign-out-alt"></i><span>SAIR</span>
            </div>
        </div>
    </div>

    <div id="content-layer" class="layer hide">
        <div class="col-cat">
            <div class="cat-head">CATEGORIAS</div>
            <div id="cat-list" class="cat-list"></div>
        </div>
        <div class="col-list">
            <div class="search-area">
                <input type="text" id="search" class="inp-search" placeholder="PESQUISAR..." autocomplete="off">
            </div>
            <div id="item-list" class="item-list"></div>
        </div>
        <div class="col-play">
            <div id="vid-box" class="vid-box">
                <video id="player" playsinline webkit-playsinline></video>
                <div id="osd" class="osd"></div>
            </div>
            <div class="meta">
                <div id="meta-title" class="meta-title">R&C GOLD</div>
                <div id="meta-desc" style="color:#777">Selecione um canal para assistir.</div>
                
                <div class="keys">
                    <div class="key"><div class="dot" style="background:#ff4444"></div> TELA CHEIA</div>
                    <div class="key"><div class="dot" style="background:#00C851"></div> TOPO</div>
                    <div class="key"><div class="dot" style="background:#ffbb33"></div> BUSCAR</div>
                    <div class="key"><div class="dot" style="background:#33b5e5"></div> MENU</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURAÇÃO LEVE PARA NETRANGE
        var HlsConfig = {
            maxBufferLength: 10, maxMaxBufferLength: 20, // Buffer pequeno = menos RAM
            backBufferLength: 0, // Limpa o passado
            manifestLoadingTimeOut: 20000,
            enableWorker: true
        };

        var Player = {
            hls: null, video: null, url: null,
            init: function() { this.video = document.getElementById('player'); },
            play: function(url) {
                if(this.hls) { this.hls.destroy(); this.hls=null; }
                this.url = url;
                if(url.includes('.ts')) url = url.replace('.ts', '.m3u8'); // Força HLS
                
                if(Hls.isSupported()) {
                    this.hls = new Hls(HlsConfig);
                    this.hls.loadSource(url);
                    this.hls.attachMedia(this.video);
                    this.hls.on(Hls.Events.MANIFEST_PARSED, function(){ Player.video.play().catch(e=>{}); });
                    this.hls.on(Hls.Events.ERROR, function(e,d){ 
                        if(d.fatal && d.type === Hls.ErrorTypes.NETWORK_ERROR) Player.hls.startLoad();
                    });
                } else {
                    this.video.src = url; this.video.play();
                }
            },
            stop: function() { 
                if(this.hls) { this.hls.destroy(); this.hls=null; }
                this.video.pause(); this.video.removeAttribute('src'); this.video.load();
            }
        };

        var App = {
            scr: 0, zone: 0, idx: 0, creds: {}, fullData: [], lastCat: 0,

            init: function() {
                Player.init();
                var c = localStorage.getItem('rc_creds');
                if(c) { 
                    var parsed = JSON.parse(c);
                    document.getElementById('i0').value = parsed.h;
                    document.getElementById('i1').value = parsed.u;
                    document.getElementById('i2').value = parsed.p;
                }
                setInterval(this.clock, 1000); this.clock();
                this.updateFocus();
            },

            clock: function() {
                var d = new Date();
                var h = d.getHours(); var m = d.getMinutes();
                var strTime = (h<10?'0'+h:h) + ":" + (m<10?'0'+m:m);
                document.getElementById('clock-time').innerText = strTime;
                
                var opts = { weekday: 'long', day: 'numeric', month: 'long' };
                document.getElementById('clock-date').innerText = d.toLocaleDateString('pt-BR', opts).toUpperCase();
            },

            req: function(url, cb) {
                var x = new XMLHttpRequest();
                x.open('GET', url, true); x.timeout = 20000;
                x.onload = function() { if(x.status==200) try{cb(JSON.parse(x.responseText))}catch(e){cb(null)} else cb(null); };
                x.onerror = function() { cb(null); };
                x.send();
            },

            fmtDate: function(ts) {
                if(!ts) return "---";
                return new Date(ts*1000).toLocaleDateString('pt-BR');
            },

            login: function() {
                var h = document.getElementById('i0').value.trim();
                var u = document.getElementById('i1').value.trim();
                var p = document.getElementById('i2').value.trim();
                if(!h.startsWith('http')) h = 'http://'+h;
                if(h.endsWith('/')) h = h.slice(0,-1);

                document.getElementById('loader').classList.remove('hide');
                
                this.req(h+"/player_api.php?username="+u+"&password="+p, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d && d.user_info && d.user_info.auth == 1) {
                        App.creds = {h:h, u:u, p:p};
                        localStorage.setItem('rc_creds', JSON.stringify(App.creds));
                        
                        // POPULA DADOS DO DASHBOARD
                        var info = d.user_info;
                        document.getElementById('u-name').innerText = info.username;
                        document.getElementById('u-exp').innerText = App.fmtDate(info.exp_date);
                        document.getElementById('u-created').innerText = App.fmtDate(info.created_at);
                        
                        var active = info.active_cons || 0;
                        var max = info.max_connections || 1;
                        document.getElementById('u-conn').innerText = active + " / " + max;

                        App.setScr(1);
                    } else {
                        document.getElementById('msg-login').innerText = "Login Falhou!";
                    }
                });
            },

            logout: function() { localStorage.removeItem('rc_creds'); location.reload(); },

            setScr: function(n) {
                if(n===1) Player.stop();
                this.scr=n; this.zone=0; this.idx=0;
                document.querySelectorAll('.layer').forEach(l=>l.classList.add('hide'));
                
                if(n===0) document.getElementById('login-layer').classList.remove('hide');
                if(n===1) document.getElementById('dash-layer').classList.remove('hide');
                if(n===2) document.getElementById('content-layer').classList.remove('hide');
                
                this.updateFocus();
            },

            openMode: function() {
                this.setScr(2);
                document.getElementById('loader').classList.remove('hide');
                document.getElementById('cat-list').innerHTML = '';
                document.getElementById('item-list').innerHTML = '';
                
                var url = this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action=get_live_categories";
                this.req(url, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d) {
                        var h = '';
                        for(var i=0; i<d.length; i++) h += '<div id="c'+i+'" class="cat-item" data-id="'+d[i].category_id+'">'+d[i].category_name+'</div>';
                        document.getElementById('cat-list').innerHTML = h;
                        App.zone=0; App.idx=0; App.updateFocus();
                    }
                });
            },

            loadCat: function(i) {
                var el = document.getElementById('c'+i); if(!el) return;
                var id = el.getAttribute('data-id');
                document.querySelectorAll('.cat-item').forEach(e=>e.classList.remove('active'));
                el.classList.add('active');
                
                document.getElementById('loader').classList.remove('hide');
                var url = this.creds.h+"/player_api.php?username="+this.creds.u+"&password="+this.creds.p+"&action=get_live_streams&category_id="+id;
                
                this.req(url, function(d){
                    document.getElementById('loader').classList.add('hide');
                    if(d) {
                        App.fullData = d;
                        var max = d.length > 100 ? 100 : d.length; // Limite segurança
                        var h = '';
                        for(var k=0; k<max; k++) h += '<div id="r'+k+'" class="item">'+d[k].name+'</div>';
                        document.getElementById('item-list').innerHTML = h;
                        App.zone=2; App.idx=0; App.updateFocus();
                    }
                });
            },

            playItem: function() {
                var item = this.fullData[this.idx];
                if(!item) return;
                
                document.querySelectorAll('.item').forEach(e=>e.classList.remove('playing'));
                var el = document.getElementById('r'+this.idx); if(el) el.classList.add('playing');
                
                document.getElementById('meta-title').innerText = item.name;
                var url = this.creds.h+"/live/"+this.creds.u+"/"+this.creds.p+"/"+item.stream_id+".m3u8";
                Player.play(url);
            },
            
            toggleFull: function() {
                var vb = document.getElementById('vid-box');
                if(vb.classList.contains('fs')) {
                    vb.classList.remove('fs');
                } else {
                    vb.classList.add('fs');
                    App.osd("TELA CHEIA");
                }
            },
            
            search: function() {
                var t = document.getElementById('search').value.toLowerCase();
                if(t.length < 3) return;
                var res = this.fullData.filter(x => x.name.toLowerCase().includes(t));
                var h = '';
                for(var k=0; k<res.length && k<50; k++) h += '<div id="r'+k+'" class="item">'+res[k].name+'</div>';
                document.getElementById('item-list').innerHTML = h;
                this.fullData = res; 
                this.zone=2; this.idx=0; this.updateFocus();
            },

            osd: function(t) { var o=document.getElementById('osd'); o.innerText=t; o.style.display='block'; setTimeout(()=>o.style.display='none',2000); },

            updateFocus: function() {
                document.querySelectorAll('.focused').forEach(e=>e.classList.remove('focused'));
                var el;
                if(this.scr===0) el=document.getElementById('i'+this.idx);
                if(this.scr===1) el=document.getElementById('m'+this.idx);
                if(this.scr===2) {
                    if(this.zone===0) el=document.getElementById('c'+this.idx);
                    if(this.zone===1) el=document.getElementById('search');
                    if(this.zone===2) el=document.getElementById('r'+this.idx);
                }
                if(el) {
                    el.classList.add('focused');
                    if(el.tagName!=='INPUT') { document.activeElement.blur(); el.scrollIntoView({block:'center'}); } else el.focus();
                }
            },
            
            back: function() {
                if(document.getElementById('vid-box').classList.contains('fs')) { this.toggleFull(); return; }
                if(this.scr===2) {
                    if(this.zone===2 || this.zone===1) { this.zone=0; this.idx=this.lastCat; this.updateFocus(); return; }
                    this.setScr(1);
                    return;
                }
                if(this.scr===1) this.logout();
            },

            move: function(d) {
                if(this.scr===0) { if(d===1 && this.idx<3) this.idx++; if(d===0 && this.idx>0) this.idx--; }
                if(this.scr===1) { if(d===3) this.idx=1; if(d===2) this.idx=0; } // Esquerda/Direita
                if(this.scr===2) {
                    if(document.getElementById('vid-box').classList.contains('fs')) return;
                    if(this.zone===0) {
                        var max = document.getElementById('cat-list').children.length-1;
                        if(d===1 && this.idx<max) this.idx++;
                        if(d===0 && this.idx>0) this.idx--;
                        if(d===3) { this.zone=2; this.idx=0; }
                    } else if(this.zone===2) {
                        var max = document.getElementById('item-list').children.length-1;
                        if(d===1 && this.idx<max) this.idx++;
                        if(d===0) { if(this.idx>0) this.idx--; else this.zone=1; }
                        if(d===2) { this.zone=0; this.idx=this.lastCat; }
                    } else if(this.zone===1) {
                        if(d===1) { this.zone=2; this.idx=0; }
                        if(d===2) { this.zone=0; this.idx=this.lastCat; }
                    }
                }
                this.updateFocus();
            }
        };

        document.addEventListener('keydown', function(e) {
            var k = e.keyCode;
            
            // TECLAS COLORIDAS (Mapeamento Padrão Samsung/LG/Philco)
            if(k===403 || k===82) { App.toggleFull(); } // VERMELHO
            if(k===404 || k===71) { if(App.scr===2 && App.zone===2) { App.idx=0; App.updateFocus(); App.osd("TOPO"); } } // VERDE
            if(k===405 || k===89) { if(App.scr===2) { App.zone=1; App.updateFocus(); } } // AMARELO
            if(k===406 || k===66) { if(App.scr===2) App.setScr(1); } // AZUL

            // NAVEGAÇÃO
            if(k===37) { e.preventDefault(); App.move(2); }
            if(k===38) { e.preventDefault(); App.move(0); }
            if(k===39) { e.preventDefault(); App.move(3); }
            if(k===40) { e.preventDefault(); App.move(1); }
            
            if(k===13) { 
                e.preventDefault(); 
                if(App.scr===0 && App.idx===3) App.login();
                else if(App.scr===1) { if(App.idx===0) App.openMode(); else App.logout(); }
                else if(App.scr===2) {
                    if(App.zone===0) { App.lastCat=App.idx; App.loadCat(App.idx); }
                    if(App.zone===1) App.search();
                    if(App.zone===2) App.playItem();
                }
            }
            if(k===8 || k===27 || k===461) { e.preventDefault(); App.back(); }
        });
    </script>
</body>
</html>
